"""
–ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è –∑–∞–ø—É—Å–∫–∞ Wildberries AI Agent

–ó–∞–ø—É—Å–∫:
    python main.py

–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤ —Å–≤–æ–µ–º –∫–æ–¥–µ:
    from ai_agent import WildberriesAIAgent
    
    agent = WildberriesAIAgent("–≤–∞—à_api_—Ç–æ–∫–µ–Ω")
    agent.execute("–ü–æ–∫–∞–∂–∏ –≤—Å–µ –º–æ–∏ —Ç–æ–≤–∞—Ä—ã")
"""

import os
import sys
from ai_agent import WildberriesAIAgent
from dotenv import load_dotenv

# –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ .env —Ñ–∞–π–ª–∞
load_dotenv()


def get_token():
    """–ü–æ–ª—É—á–∞–µ—Ç —Ç–æ–∫–µ–Ω –∏–∑ .env —Ñ–∞–π–ª–∞ –∏–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è"""
    token = os.environ.get("WB_API_TOKEN")
    
    if not token:
        # –ü—Ä–æ–±—É–µ–º –ø—Ä–æ—á–∏—Ç–∞—Ç—å –∏–∑ .env —Ñ–∞–π–ª–∞ –Ω–∞–ø—Ä—è–º—É—é
        env_path = os.path.join(os.path.dirname(__file__), '.env')
        if os.path.exists(env_path):
            with open(env_path, 'r', encoding='utf-8') as f:
                for line in f:
                    if line.startswith('WB_API_TOKEN='):
                        token = line.strip().split('=', 1)[1]
                        # –£–±–∏—Ä–∞–µ–º –∫–∞–≤—ã—á–∫–∏ –µ—Å–ª–∏ –µ—Å—Ç—å
                        token = token.strip('\'"')
                        break
    
    return token


def create_env_file(token):
    """–°–æ–∑–¥–∞–µ—Ç .env —Ñ–∞–π–ª —Å —Ç–æ–∫–µ–Ω–æ–º"""
    env_path = os.path.join(os.path.dirname(__file__), '.env')
    with open(env_path, 'w', encoding='utf-8') as f:
        f.write(f"WB_API_TOKEN={token}\n")
    print(f"‚úÖ –¢–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ —Ñ–∞–π–ª: {env_path}")
    print("   –≠—Ç–æ—Ç —Ñ–∞–π–ª –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–∫–ª—é—á–µ–Ω –∏–∑ Git (.gitignore)")


def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ –∞–≥–µ–Ω—Ç–∞"""
    
    print("=" * 80)
    print("WILDBERRIES AI AGENT")
    print("–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∞–≥–∞–∑–∏–Ω–æ–º –Ω–∞ Wildberries")
    print("=" * 80)
    print()
    
    # –ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω
    token = get_token()
    
    if not token:
        print("‚ö†Ô∏è  –¢—Ä–µ–±—É–µ—Ç—Å—è API —Ç–æ–∫–µ–Ω Wildberries")
        print()
        print("–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω:")
        print("1. –í–æ–π–¥–∏—Ç–µ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –ø—Ä–æ–¥–∞–≤—Ü–∞: https://seller.wildberries.ru")
        print("2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª '–ü—Ä–æ—Ñ–∏–ª—å' ‚Üí 'API –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏'")
        print("3. –ù–∞–∂–º–∏—Ç–µ '–°–æ–∑–¥–∞—Ç—å —Ç–æ–∫–µ–Ω'")
        print("4. –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–æ—Å—Ç—É–ø–∞ (Content, Statistics, Marketplace, Promotion)")
        print("5. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω")
        print()
        
        # –°–ø—Ä–∞—à–∏–≤–∞–µ–º —Ç–æ–∫–µ–Ω
        token = input("–í–≤–µ–¥–∏—Ç–µ –≤–∞—à API —Ç–æ–∫–µ–Ω (–∏–ª–∏ 'demo' –¥–ª—è –¥–µ–º–æ-—Ä–µ–∂–∏–º–∞): ").strip()
        
        if token.lower() == "demo":
            print("\nüéÆ –î–ï–ú–û-–†–ï–ñ–ò–ú")
            print("–í –¥–µ–º–æ-—Ä–µ–∂–∏–º–µ –ø–æ–∫–∞–∑–∞–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–∞–±–æ—Ç—ã –±–µ–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API")
            print("–î–ª—è —Ä–µ–∞–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã –≤–≤–µ–¥–∏—Ç–µ –Ω–∞—Å—Ç–æ—è—â–∏–π —Ç–æ–∫–µ–Ω\n")
            demo_mode()
            return
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–∫–µ–Ω –≤ .env —Ñ–∞–π–ª
        if token:
            create_env_file(token)
            print()
    
    if not token:
        print("‚ùå –¢–æ–∫–µ–Ω –Ω–µ –≤–≤–µ–¥–µ–Ω. –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ.")
        return
    
    # –°–æ–∑–¥–∞–µ–º –∞–≥–µ–Ω—Ç–∞
    try:
        agent = WildberriesAIAgent(api_token=token)
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: {e}")
        return
    
    print()
    print("‚úÖ –ê–≥–µ–Ω—Ç –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!")
    print("–í–≤–µ–¥–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É –∏–ª–∏ 'help' –¥–ª—è —Å–ø—Ä–∞–≤–∫–∏, 'exit' –¥–ª—è –≤—ã—Ö–æ–¥–∞")
    print()
    
    # –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º
    while True:
        try:
            query = input("üìù –í–∞—à –∑–∞–ø—Ä–æ—Å: ").strip()
            
            if not query:
                continue
            
            if query.lower() in ["exit", "quit", "–≤—ã—Ö–æ–¥", "–≤—ã–π—Ç–∏", "q"]:
                print("\nüëã –î–æ —Å–≤–∏–¥–∞–Ω–∏—è!")
                break
            
            if query.lower() in ["help", "–ø–æ–º–æ—â—å", "—Å–ø—Ä–∞–≤–∫–∞", "?"]:
                agent.get_help()
                continue
            
            # –í—ã–ø–æ–ª–Ω—è–µ–º –∑–∞–ø—Ä–æ—Å
            agent.execute(query)
            print()
            
        except KeyboardInterrupt:
            print("\n\nüëã –î–æ —Å–≤–∏–¥–∞–Ω–∏—è!")
            break
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞: {e}")


def demo_mode():
    """–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ä–µ–∂–∏–º –±–µ–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö API –∑–∞–ø—Ä–æ—Å–æ–≤"""
    
    print("=" * 80)
    print("üéÆ –î–ï–ú–û–ù–°–¢–†–ê–¶–ò–Ø –†–ê–ë–û–¢–´ –ê–ì–ï–ù–¢–ê")
    print("=" * 80)
    print()
    
    demo_scenarios = [
        ("–ü–æ–∫–∞–∂–∏ –≤—Å–µ –º–æ–∏ —Ç–æ–≤–∞—Ä—ã", 
         "–ê–≥–µ–Ω—Ç –≤—ã–∑–æ–≤–µ—Ç –º–µ—Ç–æ–¥ get_products_list –∏ –ø–æ–∫–∞–∂–µ—Ç –∫–∞—Ç–∞–ª–æ–≥ —Å —Ü–µ–Ω–∞–º–∏"),
        
        ("–ö–∞–∫–∞—è –≤—ã—Ä—É—á–∫–∞ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π?",
         "–ê–≥–µ–Ω—Ç —Å–æ–±–µ—Ä–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ sales_report –∏ —Ä–∞—Å—Å—á–∏—Ç–∞–µ—Ç –≤—ã—Ä—É—á–∫—É"),
        
        ("–¢–æ–ø 10 –ø—Ä–æ–¥–∞–≤–∞–µ–º—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤",
         "–ê–≥–µ–Ω—Ç –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø—Ä–æ–¥–∞–∂–∏ –∏ –≤—ã–≤–µ–¥–µ—Ç —Ç–æ–ø –ø–æ –≤—ã—Ä—É—á–∫–µ"),
        
        ("–û–±–Ω–æ–≤–∏ —Ü–µ–Ω—É —Ç–æ–≤–∞—Ä–∞ 12345 –Ω–∞ 1500 —Ä—É–±–ª–µ–π",
         "–ê–≥–µ–Ω—Ç –≤—ã–∑–æ–≤–µ—Ç update_prices –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–µ–Ω—ã"),
        
        ("–ó–∞–ø—É—Å—Ç–∏ —Ä–µ–∫–ª–∞–º–Ω—É—é –∫–∞–º–ø–∞–Ω–∏—é 67890",
         "–ê–≥–µ–Ω—Ç –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –∫–∞–º–ø–∞–Ω–∏—é —á–µ—Ä–µ–∑ start_campaign"),
        
        ("–û—Å—Ç–∞–Ω–æ–≤–∏ –∫–∞–º–ø–∞–Ω–∏—é 67890",
         "–ê–≥–µ–Ω—Ç –ø–æ—Å—Ç–∞–≤–∏—Ç –∫–∞–º–ø–∞–Ω–∏—é –Ω–∞ –ø–∞—É–∑—É"),
        
        ("–ù–æ–≤—ã–µ –∑–∞–∫–∞–∑—ã –¥–ª—è —Å–±–æ—Ä–∫–∏",
         "–ê–≥–µ–Ω—Ç –ø–æ–ª—É—á–∏—Ç —Å–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤ FBS"),
    ]
    
    for query, description in demo_scenarios:
        print(f"\nüìù –ó–∞–ø—Ä–æ—Å: \"{query}\"")
        print(f"üîç –î–µ–π—Å—Ç–≤–∏–µ: {description}")
        print("-" * 80)
    
    print("\n\nüìö –î–õ–Ø –ü–†–û–ì–†–ê–ú–ú–ò–°–¢–û–í:")
    print("\n–í—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–≥–µ–Ω—Ç–∞ –≤ —Å–≤–æ–µ–º –∫–æ–¥–µ:")
    print("""
from ai_agent import WildberriesAIAgent

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
agent = WildberriesAIAgent("–≤–∞—à_api_—Ç–æ–∫–µ–Ω")

# –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥
agent.execute("–ü–æ–∫–∞–∂–∏ –≤—Å–µ –º–æ–∏ —Ç–æ–≤–∞—Ä—ã")
agent.execute("–ö–∞–∫–∞—è –≤—ã—Ä—É—á–∫–∞ –∑–∞ 30 –¥–Ω–µ–π?")
agent.execute("–¢–æ–ø 5 —Ç–æ–≤–∞—Ä–æ–≤")

# –î–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
result = agent.last_result

# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–µ–Ω–µ–¥–∂–µ—Ä—ã –Ω–∞–ø—Ä—è–º—É—é
products = agent.products.get_all_products()
revenue = agent.analytics.calculate_revenue(days=30)
campaigns = agent.advertising.get_campaigns()
""")
    
    print("\n\nüìÅ –°–¢–†–£–ö–¢–£–†–ê –ü–†–û–ï–ö–¢–ê:")
    print("""
wildberries-ai-agent/
‚îú‚îÄ‚îÄ wb_client.py          # –ë–∞–∑–æ–≤—ã–π HTTP –∫–ª–∏–µ–Ω—Ç
‚îú‚îÄ‚îÄ api_registry.py       # –†–µ–µ—Å—Ç—Ä –≤—Å–µ—Ö –º–µ—Ç–æ–¥–æ–≤ API
‚îú‚îÄ‚îÄ managers.py           # –£–¥–æ–±–Ω—ã–µ –∫–ª–∞—Å—Å—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API
‚îú‚îÄ‚îÄ ai_agent.py          # –ò–ò-–∞–≥–µ–Ω—Ç —Å –∞–≤—Ç–æ–≤—ã–±–æ—Ä–æ–º –º–µ—Ç–æ–¥–æ–≤
‚îú‚îÄ‚îÄ main.py              # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (CLI)
‚îî‚îÄ‚îÄ README.md            # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
""")
    
    print("\n‚ú® –ì–æ—Ç–æ–≤—ã –Ω–∞—á–∞—Ç—å? –ü–æ–ª—É—á–∏—Ç–µ API —Ç–æ–∫–µ–Ω –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–Ω–æ–≤–∞!")


if __name__ == "__main__":
    main()
